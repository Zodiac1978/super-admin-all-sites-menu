!function(){"use strict";class t{constructor(t,e,a){this.name=t,this.table=e,this.keys=a}database(){const t=new Dexie(this.name);let e=1;for(let a of this.keys)t.version(e).stores({[this.table]:a}),e++;return t}async save(t){const e=this.database();await e[this.table].bulkPut(t).then((()=>{e.close()})).catch((t=>{console.error(t)}))}async read(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name";const e=this.database();return await e[this.table].orderBy(t).toArray().then((t=>(e.close(),t))).catch((t=>{console.error(t)}))}async getFirstRow(){const t=this.database();return await t[this.table].orderBy(":id").first().then((e=>(t.close(),e))).catch((t=>{console.error(t)}))}async delete(){const t=new Dexie(this.name);await t.delete().then((()=>{t.close()})).catch((t=>{console.warn(t)}))}async count(){const t=this.database();return await t[this.table].count().then((e=>(t.close(),e))).catch((t=>{console.error(t)}))}async getVersion(){return await new Dexie(this.name).open().then((t=>{const e=t.verno;return t.close(),e})).catch((t=>{console.error(t)}))}}async function e(t){const a=document.querySelector("#load-more-increment"),n=new FormData;n.append("action","all_sites_menu_action"),n.append("nonce",pluginAllSitesMenu.nonce),n.append("increment",a.dataset.increment);const s=pluginAllSitesMenu.ajaxurl;try{const i=await fetch(s,{method:"POST",credentials:"same-origin",body:n}),r=await i.json();"success"===r.response&&(a.dataset.increment=parseInt(a.dataset.increment)+pluginAllSitesMenu.loadincrements,t.save(r.data),await e(t))}catch(t){console.error(t)}}function a(t,e){let a;return!!t&&(t.classList&&t.classList.contains?t.classList.contains(e):!!t.className&&(a=t.className.split(" "),a.indexOf(e)>-1))}var n=window.wp.i18n;document.addEventListener("DOMContentLoaded",(()=>{if(!document.getElementById("wpadminbar"))return;const s={load:document.querySelector("#wp-admin-bar-load-more"),menu:document.querySelector("#wp-admin-bar-my-sites-list"),increment:document.querySelector("#load-more-increment")};!0===pluginAllSitesMenu.displaySearch&&function(){const t=document.querySelector("#all-sites-search-text");null!==t&&t.addEventListener("keyup",(t=>{t.preventDefault();const e=t.target.value.toUpperCase(),a=document.querySelector("#wp-admin-bar-my-sites-list").getElementsByClassName("menupop");for(let t=0;t<a.length;t++){let n=a[t].querySelector(".ab-item");(n.textContent||n.innerText).toUpperCase().indexOf(e)>-1?a[t].style.display="":a[t].style.display="none"}}))}();const i=new t("allsites","sites",["id,name,url","id,name,url,timestamp"]);var r;!async function(t,a){const n=await t.getFirstRow();void 0!==n&&void 0!==n.timestamp&&a.increment.dataset.timestamp>n.timestamp&&await t.delete(),0===await t.count()&&(a.increment.dataset.increment=0,a.increment.style.display="",e(t))}(i,s),r=s.menu,new IntersectionObserver((t=>{t.forEach((t=>{const e=t.boundingClientRect,a=e.bottom<window.innerHeight&&e.bottom;if(window.matchMedia("(min-width: 783px)").matches){const t=document.querySelector("#wp-admin-bar-my-sites>.ab-sub-wrapper");a?(t.style.height="",t.querySelector("ul#wp-admin-bar-my-sites-list").style.paddingBottom="0"):(t.style.height="calc(100vh - 32px)",t.querySelector("ul#wp-admin-bar-my-sites-list").style.paddingBottom="32px")}}))}),{threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}).observe(r);const o=function(t,e){const r=new IntersectionObserver((e=>{e.forEach((t=>{const{isIntersecting:e}=t;e&&(async()=>{const t=(await i.read(pluginAllSitesMenu.orderBy)).reduce(((t,e)=>t+function(t){return`\n\t\t\t\t<li id="wp-admin-bar-${t.id}" class="menupop">\n\t\t\t\t<a class="ab-item" aria-haspopup="true" href="${t.admin}/"><span class="wp-admin-bar-arrow" aria-hidden="true"></span>\n\t\t\t\t\t${t.title}\n\t\t\t\t</a>\n\t\t\t\t<div class="ab-sub-wrapper">\n\t\t\t\t\t<ul id="wp-admin-bar-${t.id}-default" class="ab-submenu">\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-d"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}">${(0,n.__)("Dashboard","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-n"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/post-new.php">${(0,n.__)("New Post","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-o"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/post-new.php?post_type=page">${(0,n.__)("New Page","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-c"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/edit-comments.php">${(0,n.__)("Manage Comments","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-u"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/users.php">${(0,n.__)("Users","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-p"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/plugins.php">${(0,n.__)("Plugins","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-s"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.admin}/options-general.php">${(0,n.__)("Settings","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t\t<li id="wp-admin-bar-${t.id}-v"><a class="ab-item"\n\t\t\t\t\t\t\t\thref="${t.url}/">${(0,n.__)("Visit","super-admin-all-sites-menu")}</a></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t`}(e)),"");s.load.insertAdjacentHTML("beforeBegin",t),function(){const t=document.getElementById("wp-admin-bar-my-sites-list");t&&(t.addEventListener("mouseenter",(t=>{t.stopPropagation(),t.target.classList.contains("menupop")&&function(t,e){if(!t)return;t.classList&&t.classList.add?t.classList.add(e):a(t,e)||(t.className&&(t.className+=" "),t.className+=e);let n=t.getBoundingClientRect().top,s=t.querySelector(".ab-submenu");s.style.top=n-6+"px",s.getBoundingClientRect().bottom>window.innerHeight&&(s.style.top="auto",s.style.bottom="0")}(t.target,"hover")}),{capture:!0}),t.addEventListener("mouseleave",(t=>{t.stopPropagation(),t.target.classList.contains("menupop")&&function(t,e){let n,s;if(t||a(t,e))if(t.classList&&t.classList.remove)t.classList.remove(e);else{for(n=` ${e} `,s=` ${t.className} `;s.indexOf(n)>-1;)s=s.replace(n,"");t.className=s.replace(/^[\s]+|[\s]+$/g,"")}}(t.target,"hover")}),{capture:!0}),t.addEventListener("keydown",(t=>{"Tab"===t.key&&(t.preventDefault(),t.target.classList.contains("menupop")&&toggleClass(t.target,"hover"))}),{capture:!0}))}(),s.load.style.display="none",o.unobserve(s.load)})()}),{root:t})}));return r.observe(t),r}(s.load)}))}();